const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/maplibre-gl.6QSiWS2M.js","_astro/index.caxmlYbZ.js"])))=>i.map(i=>d[i]);
import{j as d,I as R,c as C}from"./clsx.CgF43iZy.js";import{r as l}from"./index.caxmlYbZ.js";import{r as K}from"./index.BT_cHE16.js";import{d as I,p,t as ee}from"./consts.B__6xNjp.js";import{u as L,b as O,a as te,s as ne,v as oe}from"./stores.BHxV1Mey.js";const re="modulepreload",se=function(t){return"/"+t},F={},ae=function(e,n,o){let r=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),a=s?.nonce||s?.getAttribute("nonce");r=Promise.all(n.map(i=>{if(i=se(i),i in F)return;F[i]=!0;const c=i.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${u}`))return;const f=document.createElement("link");if(f.rel=c?"stylesheet":re,c||(f.as="script",f.crossOrigin=""),f.href=i,a&&f.setAttribute("nonce",a),document.head.appendChild(f),c)return new Promise((h,v)=>{f.addEventListener("load",h),f.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${i}`)))})}))}return r.then(()=>e()).catch(s=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s})},Q=l.createContext(null);function ie(){var t;const e=(t=l.useContext(Q))===null||t===void 0?void 0:t.maps,n=l.useContext(S);return l.useMemo(()=>({...e,current:n?.map}),[e,n])}function le(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,o=Array.isArray(t)?t[1]:t?t.y:0,r=Array.isArray(e)?e[0]:e?e.x:0,s=Array.isArray(e)?e[1]:e?e.y:0;return n===r&&o===s}function _(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!_(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),o=Object.keys(e);if(n.length!==o.length)return!1;for(const r of n)if(!e.hasOwnProperty(r)||!_(t[r],e[r]))return!1;return!0}return!1}function ce(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function U(t,e){if(!t.getProjection)return;const n=t.getProjection(),o=e.getProjection();_(n,o)||e.setProjection(n)}function D(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function $(t,e){const n=e.viewState||e;let o=!1;if("longitude"in n&&"latitude"in n){const r=t.center;t.center=new r.constructor(n.longitude,n.latitude),o=o||r!==t.center}if("zoom"in n){const r=t.zoom;t.zoom=n.zoom,o=o||r!==t.zoom}if("bearing"in n){const r=t.bearing;t.bearing=n.bearing,o=o||r!==t.bearing}if("pitch"in n){const r=t.pitch;t.pitch=n.pitch,o=o||r!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(o=!0,t.padding=n.padding),o}const ue=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function B(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const o of t.layers)e[o.id]=o;const n=t.layers.map(o=>{let r=null;"interactive"in o&&(r=Object.assign({},o),delete r.interactive);const s=e[o.ref];if(s){r=r||Object.assign({},o),delete r.ref;for(const a of ue)a in s&&(r[a]=s[a])}return r||o});return{...t,layers:n}}var H={};const V={version:8,sources:{},layers:[]},Z={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},P={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},q={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},de=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],fe=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class M{constructor(e,n,o){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=r=>{const s=this.props[q[r.type]];s?s(r):r.type==="error"&&console.error(r.error)},this._onPointerEvent=r=>{(r.type==="mousemove"||r.type==="mouseout")&&this._updateHover(r);const s=this.props[Z[r.type]];s&&(this.props.interactiveLayerIds&&r.type!=="mouseover"&&r.type!=="mouseout"&&(r.features=this._hoveredFeatures||this._queryRenderedFeatures(r.point)),s(r),delete r.features)},this._onCameraEvent=r=>{if(!this._internalUpdate){const s=this.props[P[r.type]];s&&s(r)}r.type in this._deferredEvents&&(this._deferredEvents[r.type]=!1)},this._MapClass=e,this.props=n,this._initialize(o)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const o=this._updateSettings(e,n);o&&this._createShadowTransform(this._map);const r=this._updateSize(e),s=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(o||r||s&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const o=M.savedMaps.pop();if(!o)return null;const r=o.map,s=r.getContainer();for(n.className=s.className;s.childNodes.length>0;)n.appendChild(s.childNodes[0]);r._container=n;const a=r._resizeObserver;a&&(a.disconnect(),a.observe(n)),o.setProps({...e,styleDiffing:!1}),r.resize();const{initialViewState:i}=e;return i&&(i.bounds?r.fitBounds(i.bounds,{...i.fitBoundsOptions,duration:0}):o._updateViewState(i,!1)),r.isStyleLoaded()?r.fire("load"):r.once("styledata",()=>r.fire("load")),r._update(),o}_initialize(e){const{props:n}=this,{mapStyle:o=V}=n,r={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||me()||null,container:e,style:B(o)},s=r.initialViewState||r.viewState||r;if(Object.assign(r,{center:[s.longitude||0,s.latitude||0],zoom:s.zoom||0,pitch:s.pitch||0,bearing:s.bearing||0}),n.gl){const f=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=f,n.gl)}const a=new this._MapClass(r);s.padding&&a.setPadding(s.padding),n.cursor&&(a.getCanvas().style.cursor=n.cursor),this._createShadowTransform(a);const i=a._render;a._render=f=>{this._inRender=!0,i.call(a,f),this._inRender=!1};const c=a._renderTaskQueue.run;a._renderTaskQueue.run=f=>{c.call(a._renderTaskQueue,f),this._onBeforeRepaint()},a.on("render",()=>this._onAfterRepaint());const u=a.fire;a.fire=this._fireEvent.bind(this,u),a.on("resize",()=>{this._renderTransform.resize(a.transform.width,a.transform.height)}),a.on("styledata",()=>{this._updateStyleComponents(this.props,{}),U(a.transform,this._renderTransform)}),a.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const f in Z)a.on(f,this._onPointerEvent);for(const f in P)a.on(f,this._onCameraEvent);for(const f in q)a.on(f,this._onEvent);this._map=a}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n?.remove(),M.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=ce(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const o=this._map;if(n.width!==o.transform.width||n.height!==o.transform.height)return o.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const o=this._map,r=this._renderTransform,{zoom:s,pitch:a,bearing:i}=r,c=o.isMoving();c&&(r.cameraElevationReference="sea");const u=$(r,{...D(o.transform),...e});if(c&&(r.cameraElevationReference="ground"),u&&n){const f=this._deferredEvents;f.move=!0,f.zoom||(f.zoom=s!==r.zoom),f.rotate||(f.rotate=i!==r.bearing),f.pitch||(f.pitch=a!==r.pitch)}return c||$(o.transform,e),u}_updateSettings(e,n){const o=this._map;let r=!1;for(const s of de)if(s in e&&!_(e[s],n[s])){r=!0;const a=o[`set${s[0].toUpperCase()}${s.slice(1)}`];a?.call(o,e[s])}return r}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==n.mapStyle){const{mapStyle:o=V,styleDiffing:r=!0}=e,s={diff:r};return"localIdeographFontFamily"in e&&(s.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(B(o),s),!0}return!1}_updateStyleComponents(e,n){const o=this._map;let r=!1;return o.isStyleLoaded()&&("light"in e&&o.setLight&&!_(e.light,n.light)&&(r=!0,o.setLight(e.light)),"fog"in e&&o.setFog&&!_(e.fog,n.fog)&&(r=!0,o.setFog(e.fog)),"terrain"in e&&o.setTerrain&&!_(e.terrain,n.terrain)&&(!e.terrain||o.getSource(e.terrain.source))&&(r=!0,o.setTerrain(e.terrain))),r}_updateHandlers(e,n){var o,r;const s=this._map;let a=!1;for(const i of fe){const c=(o=e[i])!==null&&o!==void 0?o:!0,u=(r=n[i])!==null&&r!==void 0?r:!0;_(c,u)||(a=!0,c?s[i].enable(c):s[i].disable())}return a}_queryRenderedFeatures(e){const n=this._map,o=n.transform,{interactiveLayerIds:r=[]}=this.props;try{return n.transform=this._renderTransform,n.queryRenderedFeatures(e,{layers:r.filter(n.getLayer.bind(n))})}catch{return[]}finally{n.transform=o}}_updateHover(e){var n;const{props:o}=this;if(o.interactiveLayerIds&&(o.onMouseMove||o.onMouseEnter||o.onMouseLeave)){const s=e.type,a=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,i=this._queryRenderedFeatures(e.point),c=i.length>0;!c&&a&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=i,c&&!a&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=s}else this._hoveredFeatures=null}_fireEvent(e,n,o){const r=this._map,s=r.transform,a=typeof n=="string"?n:n.type;return a==="move"&&this._updateViewState(this.props,!1),a in P&&(typeof n=="object"&&(n.viewState=D(s)),this._map.isMoving())?(r.transform=this._renderTransform,e.call(r,n,o),r.transform=s,r):(e.call(r,n,o),r)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const o in this._deferredEvents)this._deferredEvents[o]&&e.fire(o);this._internalUpdate=!1;const n=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{U(this._renderTransform,n),e.transform=n}}}M.savedMaps=[];function me(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||H.MapboxAccessToken}catch{}try{t=t||H.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const he=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function ge(t){if(!t)return null;const e=t.map,n={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:o=>{const r=e.transform;e.transform=t.transform;const s=e.project(o);return e.transform=r,s},unproject:o=>{const r=e.transform;e.transform=t.transform;const s=e.unproject(o);return e.transform=r,s},queryTerrainElevation:(o,r)=>{const s=e.transform;e.transform=t.transform;const a=e.queryTerrainElevation(o,r);return e.transform=s,a},queryRenderedFeatures:(o,r)=>{const s=e.transform;e.transform=t.transform;const a=e.queryRenderedFeatures(o,r);return e.transform=s,a}};for(const o of ye(e))!(o in n)&&!he.includes(o)&&(n[o]=e[o].bind(e));return n}function ye(t){const e=new Set;let n=t;for(;n;){for(const o of Object.getOwnPropertyNames(n))o[0]!=="_"&&typeof t[o]=="function"&&o!=="fire"&&o!=="setEventedParent"&&e.add(o);n=Object.getPrototypeOf(n)}return Array.from(e)}const pe=typeof document<"u"?l.useLayoutEffect:l.useEffect,ve=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function xe(t,e){for(const o of ve)o in e&&(t[o]=e[o]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;n&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(n,o=>{o&&console.error(o)},!0)}const S=l.createContext(null);function _e(t,e,n){const o=l.useContext(Q),[r,s]=l.useState(null),a=l.useRef(),{current:i}=l.useRef({mapLib:null,map:null});l.useEffect(()=>{const f=t.mapLib;let h=!0,v;return Promise.resolve(f||n).then(b=>{if(!h)return;if(!b)throw new Error("Invalid mapLib");const x="Map"in b?b:b.default;if(!x.Map)throw new Error("Invalid mapLib");if(xe(x,t),!x.supported||x.supported(t))t.reuseMaps&&(v=M.reuse(t,a.current)),v||(v=new M(x.Map,t,a.current)),i.map=ge(v),i.mapLib=x,s(v),o?.onMapMount(i.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(b=>{const{onError:x}=t;x?x({type:"error",target:null,originalEvent:null,error:b}):console.error(b)}),()=>{h=!1,v&&(o?.onMapUnmount(t.id),t.reuseMaps?v.recycle():v.destroy())}},[]),pe(()=>{r&&r.setProps(t)}),l.useImperativeHandle(e,()=>i.map,[r]);const c=l.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),u={height:"100%"};return l.createElement("div",{id:t.id,ref:a,style:c},r&&l.createElement(S.Provider,{value:i},l.createElement("div",{"mapboxgl-children":"",style:u},t.children)))}const be=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function j(t,e){if(!t||!e)return;const n=t.style;for(const o in e){const r=e[o];Number.isFinite(r)&&!be.test(o)?n[o]=`${r}px`:n[o]=r}}function we(t,e){const{map:n,mapLib:o}=l.useContext(S),r=l.useRef({props:t});r.current.props=t;const s=l.useMemo(()=>{let T=!1;l.Children.forEach(t.children,w=>{w&&(T=!0)});const z={...t,element:T?document.createElement("div"):null},E=new o.Marker(z);return E.setLngLat([t.longitude,t.latitude]),E.getElement().addEventListener("click",w=>{var m,g;(g=(m=r.current.props).onClick)===null||g===void 0||g.call(m,{type:"click",target:E,originalEvent:w})}),E.on("dragstart",w=>{var m,g;const y=w;y.lngLat=s.getLngLat(),(g=(m=r.current.props).onDragStart)===null||g===void 0||g.call(m,y)}),E.on("drag",w=>{var m,g;const y=w;y.lngLat=s.getLngLat(),(g=(m=r.current.props).onDrag)===null||g===void 0||g.call(m,y)}),E.on("dragend",w=>{var m,g;const y=w;y.lngLat=s.getLngLat(),(g=(m=r.current.props).onDragEnd)===null||g===void 0||g.call(m,y)}),E},[]);l.useEffect(()=>(s.addTo(n.getMap()),()=>{s.remove()}),[]);const{longitude:a,latitude:i,offset:c,style:u,draggable:f=!1,popup:h=null,rotation:v=0,rotationAlignment:b="auto",pitchAlignment:x="auto"}=t;return l.useEffect(()=>{j(s.getElement(),u)},[u]),l.useImperativeHandle(e,()=>s,[]),(s.getLngLat().lng!==a||s.getLngLat().lat!==i)&&s.setLngLat([a,i]),c&&!le(s.getOffset(),c)&&s.setOffset(c),s.isDraggable()!==f&&s.setDraggable(f),s.getRotation()!==v&&s.setRotation(v),s.getRotationAlignment()!==b&&s.setRotationAlignment(b),s.getPitchAlignment()!==x&&s.setPitchAlignment(x),s.getPopup()!==h&&s.setPopup(h),K.createPortal(t.children,s.getElement())}const Ee=l.memo(l.forwardRef(we));function W(t){return new Set(t?t.trim().split(/\s+/):[])}function Ce(t,e){const{map:n,mapLib:o}=l.useContext(S),r=l.useMemo(()=>document.createElement("div"),[]),s=l.useRef({props:t});s.current.props=t;const a=l.useMemo(()=>{const i={...t},c=new o.Popup(i);return c.setLngLat([t.longitude,t.latitude]),c.once("open",u=>{var f,h;(h=(f=s.current.props).onOpen)===null||h===void 0||h.call(f,u)}),c},[]);if(l.useEffect(()=>{const i=c=>{var u,f;(f=(u=s.current.props).onClose)===null||f===void 0||f.call(u,c)};return a.on("close",i),a.setDOMContent(r).addTo(n.getMap()),()=>{a.off("close",i),a.isOpen()&&a.remove()}},[]),l.useEffect(()=>{j(a.getElement(),t.style)},[t.style]),l.useImperativeHandle(e,()=>a,[]),a.isOpen()&&((a.getLngLat().lng!==t.longitude||a.getLngLat().lat!==t.latitude)&&a.setLngLat([t.longitude,t.latitude]),t.offset&&!_(a.options.offset,t.offset)&&a.setOffset(t.offset),(a.options.anchor!==t.anchor||a.options.maxWidth!==t.maxWidth)&&(a.options.anchor=t.anchor,a.setMaxWidth(t.maxWidth)),a.options.className!==t.className)){const i=W(a.options.className),c=W(t.className);for(const u of i)c.has(u)||a.removeClassName(u);for(const u of c)i.has(u)||a.addClassName(u);a.options.className=t.className}return K.createPortal(t.children,r)}l.memo(l.forwardRef(Ce));function N(t,e,n,o){const r=l.useContext(S),s=l.useMemo(()=>t(r),[]);return l.useEffect(()=>{const a=e,i=typeof e=="function"&&typeof n=="function"?e:null,c=typeof e=="function"?e:null,{map:u}=r;return u.hasControl(s)||(u.addControl(s,a?.position),i&&i(r)),()=>{c&&c(r),u.hasControl(s)&&u.removeControl(s)}},[]),s}function Se(t){const e=N(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return l.useEffect(()=>{j(e._container,t.style)},[t.style]),null}const je=l.memo(Se);function Le(t){const e=N(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return l.useEffect(()=>{j(e._controlContainer,t.style)},[t.style]),null}l.memo(Le);function Me(t,e){const n=l.useRef({props:t}),o=N(({mapLib:r})=>{const s=new r.GeolocateControl(t),a=s._setupUI;return s._setupUI=i=>{s._container.hasChildNodes()||a(i)},s.on("geolocate",i=>{var c,u;(u=(c=n.current.props).onGeolocate)===null||u===void 0||u.call(c,i)}),s.on("error",i=>{var c,u;(u=(c=n.current.props).onError)===null||u===void 0||u.call(c,i)}),s.on("outofmaxbounds",i=>{var c,u;(u=(c=n.current.props).onOutOfMaxBounds)===null||u===void 0||u.call(c,i)}),s.on("trackuserlocationstart",i=>{var c,u;(u=(c=n.current.props).onTrackUserLocationStart)===null||u===void 0||u.call(c,i)}),s.on("trackuserlocationend",i=>{var c,u;(u=(c=n.current.props).onTrackUserLocationEnd)===null||u===void 0||u.call(c,i)}),s},{position:t.position});return n.current.props=t,l.useImperativeHandle(e,()=>o,[]),l.useEffect(()=>{j(o._container,t.style)},[t.style]),null}l.memo(l.forwardRef(Me));function Ne(t){const e=N(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return l.useEffect(()=>{j(e._container,t.style)},[t.style]),null}const Te=l.memo(Ne);function ke(t){const e=N(({mapLib:s})=>new s.ScaleControl(t),{position:t.position}),n=l.useRef(t),o=n.current;n.current=t;const{style:r}=t;return t.maxWidth!==void 0&&t.maxWidth!==o.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==o.unit&&e.setUnit(t.unit),l.useEffect(()=>{j(e._container,r)},[r]),null}const Re=l.memo(ke);function A(t,e){if(!t)throw new Error(e)}function Ae(t,e,n,o){if(A(n.id===o.id,"layer id changed"),A(n.type===o.type,"layer type changed"),n.type==="custom"||o.type==="custom")return;const{layout:r={},paint:s={},filter:a,minzoom:i,maxzoom:c,beforeId:u}=n;if(u!==o.beforeId&&t.moveLayer(e,u),r!==o.layout){const f=o.layout||{};for(const h in r)_(r[h],f[h])||t.setLayoutProperty(e,h,r[h]);for(const h in f)r.hasOwnProperty(h)||t.setLayoutProperty(e,h,void 0)}if(s!==o.paint){const f=o.paint||{};for(const h in s)_(s[h],f[h])||t.setPaintProperty(e,h,s[h]);for(const h in f)s.hasOwnProperty(h)||t.setPaintProperty(e,h,void 0)}_(a,o.filter)||t.setFilter(e,a),(i!==o.minzoom||c!==o.maxzoom)&&t.setLayerZoomRange(e,i,c)}function ze(t,e,n){if(t.style&&t.style._loaded&&(!("source"in n)||t.getSource(n.source))){const o={...n,id:e};delete o.beforeId,t.addLayer(o,n.beforeId)}}let Pe=0;function Oe(t){const e=l.useContext(S).map.getMap(),n=l.useRef(t),[,o]=l.useState(0),r=l.useMemo(()=>t.id||`jsx-layer-${Pe++}`,[]);if(l.useEffect(()=>{if(e){const a=()=>o(i=>i+1);return e.on("styledata",a),a(),()=>{e.off("styledata",a),e.style&&e.style._loaded&&e.getLayer(r)&&e.removeLayer(r)}}},[e]),e&&e.style&&e.getLayer(r))try{Ae(e,r,t,n.current)}catch(a){console.warn(a)}else ze(e,r,t);return n.current=t,null}let Ie=0;function Fe(t,e,n){if(t.style&&t.style._loaded){const o={...n};return delete o.id,delete o.children,t.addSource(e,o),t.getSource(e)}return null}function Ue(t,e,n){A(e.id===n.id,"source id changed"),A(e.type===n.type,"source type changed");let o="",r=0;for(const a in e)a!=="children"&&a!=="id"&&!_(n[a],e[a])&&(o=a,r++);if(!r)return;const s=e.type;if(s==="geojson")t.setData(e.data);else if(s==="image")t.updateImage({url:e.url,coordinates:e.coordinates});else if("setCoordinates"in t&&r===1&&o==="coordinates")t.setCoordinates(e.coordinates);else if("setUrl"in t)switch(o){case"url":t.setUrl(e.url);break;case"tiles":t.setTiles(e.tiles);break}else console.warn(`Unable to update <Source> prop: ${o}`)}function De(t){const e=l.useContext(S).map.getMap(),n=l.useRef(t),[,o]=l.useState(0),r=l.useMemo(()=>t.id||`jsx-source-${Ie++}`,[]);l.useEffect(()=>{if(e){const a=()=>setTimeout(()=>o(i=>i+1),0);return e.on("styledata",a),a(),()=>{var i;if(e.off("styledata",a),e.style&&e.style._loaded&&e.getSource(r)){const c=(i=e.getStyle())===null||i===void 0?void 0:i.layers;if(c)for(const u of c)u.source===r&&e.removeLayer(u.id);e.removeSource(r)}}}},[e]);let s=e&&e.style&&e.getSource(r);return s?Ue(s,t,n.current):s=Fe(e,r,t),n.current=t,s&&l.Children.map(t.children,a=>a&&l.cloneElement(a,{source:r}))||null}function $e(){return ie()}const Be=ae(()=>import("./maplibre-gl.6QSiWS2M.js").then(t=>t.m),__vite__mapDeps([0,1])),He=l.forwardRef(function(e,n){return _e(e,n,Be)}),Y=Ee,Ve=je,Ze=Te,qe=Re,G=Oe,We=De,Ge="https://onestopmap.owntwin.com";class Ke{async get(e){const n=await fetch(Ge+e);if(!n.ok)throw new Error(n.statusText);return n.json()}}function Qe({dataCollection:t,activeItem:e,setActiveItem:n}){return d.jsxs("div",{className:"w-[350px] h-full border-r hidden md:flex md:flex-col bg-white",children:[d.jsx("div",{className:"flex absolute left-[350px] w-[380px] h-[calc(100svh-4rem)] transition-all ease-in-out duration-200 pl-2 py-2"+(e!==null?" z-50 absolute translate-x-0":" -z-50 opacity-0"),children:d.jsxs("div",{className:"w-full shadow bg-white border rounded-lg flex flex-col",children:[d.jsx("div",{className:"px-2 pt-2 flex justify-end",children:d.jsx("button",{onClick:()=>n(null),children:d.jsx(R,{icon:"lucide:x",className:"h-5 w-5"})})}),d.jsx("div",{className:"px-4 pb-4 text-lg text-center border-b",children:e?.properties&&e?.properties.name}),d.jsx("div",{className:"px-0 overflow-y-auto",children:d.jsx("ul",{className:"",children:e?.properties&&Object.entries(e.properties).map(([o,r],s)=>o!=="provider"&&d.jsxs("li",{className:"px-6 pt-2.5 pb-3 x-border-b hover:bg-gray-100/50 cursor-pointer",children:[d.jsx("div",{className:"text-sm text-gray-600 pb-0.5",children:t[e.datasetId]?.metadata.fields[o]??void 0}),d.jsx("div",{className:"break-all",children:r??"-"})]},s))})})]})}),d.jsx("div",{className:"w-full px-4 py-2.5 x-border-b",children:d.jsx("input",{type:"text",placeholder:"検索...",className:"shadow-sm border rounded-lg w-full h-10 px-2 bg-white hover:bg-slate-50/50 cursor-pointer",disabled:!0})}),d.jsxs("div",{className:"flex flex-col overflow-y-auto",children:[Object.entries(t).length===0&&d.jsx("div",{className:"text-center text-sm text-gray-400 pt-8",children:"データがありません"}),Object.entries(t).toSorted((o,r)=>{const s=I.findIndex(i=>i.id===o[0]),a=I.findIndex(i=>i.id===r[0]);return s===-1?1:a===-1?-1:s-a}).map(([o,r],s)=>d.jsxs("div",{children:[d.jsxs("div",{className:"sticky top-0 bg-white flex items-center border-y shadow-sm pt-3 pb-3 pl-4 pr-4",children:[p[o]!==void 0&&d.jsx("div",{className:"mr-1.5",children:p[o]?.type==="icon"?d.jsx("div",{className:C("flex items-center justify-center rounded x-border h-4 w-4 p-0.5",p[o]?.bg,p[o]?.color),children:d.jsx(R,{icon:p[o]?.icon,className:C(p[o]?.bg,p[o]?.color)})}):p[o]?.type==="circle"?d.jsx("div",{className:C("flex items-center justify-center overflow-visible w-3 h-3 x-border-2 border-white x-shadow-sm rounded-full",p[o]?.bg),children:d.jsx("div",{className:"rounded-full bg-white w-1 h-1"})}):null}),d.jsx("div",{className:"grow text-sm font-bold",children:r?.metadata?.dataset_name}),d.jsx("a",{href:`/dashboard/${o}`,children:d.jsx(R,{icon:"mage:dashboard-bar",className:"block x-border h-5 w-5"})})]}),d.jsx("ul",{className:"flex flex-col gap-y-2 pt-4 pb-4 pl-2 pr-4",children:r?.data&&r.data.features.map(({properties:a,geometry:i},c)=>d.jsxs("li",{role:"button",className:"border rounded-sm px-4 py-3 hover:bg-slate-100/50 cursor-pointer",onClick:()=>n(u=>u?.properties===a?null:{datasetId:o,properties:a,geometry:i}),children:[d.jsx("div",{className:"text-xs text-gray-600 mb-0.5",children:a.municipality_name}),d.jsx("div",{className:"text-sm",children:a.name})]},`library-${c}`))})]},s))]})]})}function Ye({width:t=600,height:e=400,initialViewState:n={},onClick:o=void 0,onLoad:r=void 0,children:s}){return d.jsxs(He,{cursor:"default",initialViewState:{longitude:139.766706,latitude:35.6812546,zoom:10,...n},style:{width:t,height:e},mapStyle:"https://tile.openstreetmap.jp/styles/maptiler-basic-ja/style.json",maxBounds:[[122,20],[155,47]],onClick:o,onLoad:r,attributionControl:!1,children:[s,d.jsx(Ze,{}),d.jsx(qe,{})]})}function Je({datasetId:t,data:e,children:n}){const[,o]=L(O);return e?e.data.features.map(({geometry:r,properties:s},a)=>d.jsx(Y,{longitude:r.coordinates[0],latitude:r.coordinates[1],anchor:"center",style:{cursor:"pointer"},onClick:i=>{i.originalEvent.stopPropagation(),o(c=>c?.properties===s?null:{datasetId:t,properties:s,geometry:r})},children:n??d.jsx("div",{className:C("flex items-center justify-center overflow-visible w-4 h-4 border-2 border-white shadow-sm rounded-full","bg-blue-500"),children:d.jsx("div",{className:"rounded-full bg-white w-1 h-1"})})},`marker-${a}`)):null}function Xe({children:t}){const[e,n]=L(O);return!e||!e.geometry?null:d.jsx(Y,{longitude:e.geometry.coordinates[0],latitude:e.geometry.coordinates[1],anchor:"center",style:{cursor:"pointer"},color:"red"},"marker-focus")}function et({bounds:t,flyTo:e}){const{current:n}=$e();return l.useEffect(()=>{t&&n?.fitBounds([[t[0],t[1]],[t[2],t[3]]])},[t,n]),l.useEffect(()=>{console.log("flyTo",e),e&&n?.flyTo({...e,padding:{left:380}})},[e,n]),null}function at({width:t=600,height:e=400}){const[n,o]=l.useState({}),[r,s]=l.useState({}),[a,i]=L(te),[c,u]=L(ne),[f,h]=L(O),[v,b]=L(oe),[x,T]=l.useState(null),z=l.useMemo(()=>new Ke,[]),[E,w]=l.useState(null);return l.useEffect(()=>{if(!c||!a){u([]),i([]);return}b(m=>{console.log("current in mapapp",m,c,a);let g=m;return c.length===0&&!m.includes("areas-modal-opened")?g.push("needs-areas"):g=g.filter(y=>y!=="needs-areas"),Array.from(new Set(g))})},[c,a]),l.useEffect(()=>{!a||!c||(async()=>{const m=a.join(","),g=c.join(","),y=await z.get(`/datasets/query?dataset_id=${m}&provider=${g}`),J=y.datasets.map(k=>({[k.metadata.dataset_id]:k}));s(()=>(console.log("response.metadata",y.metadata),y.metadata)),o(J.reduce((k,X)=>({...k,...X}),{}))})()},[a,c]),l.useEffect(()=>{if(f){const{datasetId:m,properties:g,geometry:y}=f;T({center:y.coordinates,zoom:14})}},[f]),d.jsxs(d.Fragment,{children:[d.jsx(Qe,{dataCollection:n,activeItem:f,setActiveItem:h}),d.jsx("div",{className:"p-0 grow",children:n&&d.jsxs(Ye,{initialViewState:{bounds:r?.bounds??void 0},width:t,height:e,onClick:()=>h(null),onLoad:({target:m})=>w(m),children:[Object.entries(n).map(([m,g],y)=>d.jsx(Je,{datasetId:m,data:g,children:p[m]!==void 0&&(p[m]?.type==="circle"?d.jsx("div",{className:C("flex items-center justify-center overflow-visible w-4 h-4 border-2 border-white shadow-sm rounded-full",p[m]?.bg),children:d.jsx("div",{className:"rounded-full bg-white w-1 h-1"})}):p[m]?.type==="icon"?d.jsx("div",{className:C("flex items-center justify-center rounded x-border h-4 w-4 p-0.5",p[m]?.bg,p[m]?.color),children:d.jsx(R,{icon:p[m]?.icon,className:C(p[m]?.bg,p[m]?.color)})}):null)},y)),d.jsx(Xe,{}),d.jsx(et,{bounds:r?.bounds,flyTo:x}),d.jsx(We,{id:"darken-overlay",type:"geojson",data:"/N03-21_13_210101.json",attribution:'<a href="https://nlftp.mlit.go.jp/ksj/gml/datalist/KsjTmplt-N03-2021.html">国土交通省 国土数値情報 行政区域データ</a>&nbsp;<a href="https://creativecommons.org/licenses/by/4.0/ ">CC-BY-4.0</a>'}),d.jsx(G,{id:"outline",type:"line",source:"darken-overlay",paint:{"line-color":"#888888","line-width":2}}),d.jsx(G,{id:"darken",type:"fill",source:"darken-overlay",paint:{"fill-color":"#000000","fill-opacity":["case",["in",["get","N03_004"],["literal",c?.map(m=>ee.find(g=>g.id===m)?.displayName)]],0,.25]}}),d.jsx(Ve,{compact:!1})]})})]})}export{at as MapApp};
